name: API-First Development
description: OpenAPI spec first, endpoint loop, contract test 2-way, integration fallback

steps:
  # ── Spec Phase ──

  - 1.1 Write OpenAPI spec

  - 1.2 Spec review:
      type: wait
      next:
        - if: "spec is approved"
          go: 2.0 Endpoint loop
        - go: 1.1 Write OpenAPI spec

  # ── Endpoint Loop ──

  - 2.0 Endpoint loop:
      iterate: "endpoints"
      children:
        - 2.1 Implement endpoint
        - 2.2 Write contract tests
        - 2.3 Contract test:
            next:
              - if: "contract test passes"
                go: 2.0 Endpoint loop
              - go: 2.1 Implement endpoint

  # ── Integration ──

  - 3.1 Integration testing:
      next:
        - if: "all endpoints work together"
          go: 3.2 Generate documentation
        - go: 2.0 Endpoint loop

  - 3.2 Generate documentation

  - Done:
      type: terminate
      reason: API fully implemented and documented
