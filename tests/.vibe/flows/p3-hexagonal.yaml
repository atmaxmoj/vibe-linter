name: Hexagonal Architecture
description: Port loop, adapter test 2-way, end-to-end fallback

steps:
  # ── Domain Design ──

  - 1.1 Design domain model

  - 1.2 Domain review:
      type: wait
      next:
        - if: "domain model approved"
          go: 2.0 Port loop
        - go: 1.1 Design domain model

  # ── Port Loop ──

  - 2.0 Port loop:
      iterate: "ports"
      children:
        - 2.1 Define port interface
        - 2.2 Implement adapter
        - 2.3 Adapter test:
            next:
              - if: "adapter test passes"
                go: 2.0 Port loop
              - go: 2.2 Implement adapter

  # ── End-to-End ──

  - 3.1 End-to-end testing:
      next:
        - if: "all ports and adapters work end to end"
          go: Done
        - go: 2.0 Port loop

  - Done:
      type: terminate
      reason: Hexagonal architecture verified
