name: TDD Development
description: Test-Driven Development workflow - Red, Green, Refactor

steps:
  # -- Scenario Collection --
  - 0.1 Collect scenario:
      next:
        - if: "has bug description or feature request"
          go: 1.1 Gather requirements
        - go: 0.1 Collect scenario

  # -- Design Phase --
  - 1.1 Gather requirements:
      next:
        - if: "this is a hotfix with known root cause"
          go: 2.1 Write failing test (Red)
        - go: 1.2 Design architecture

  - 1.2 Design architecture

  - 1.3 Design review:
      next:
        - if: "design is approved"
          go: 2.0 Feature loop
        - go: 1.2 Design architecture

  # -- TDD Feature Loop --
  - 2.0 Feature loop:
      iterate: "features"
      children:
        - 2.1 Write failing test (Red)
        - 2.2 Write minimal code (Green)
        - 2.3 Refactor
        - 2.4 Run test suite
        - 2.5 Quality check:
            next:
              - if: "all tests pass and code quality is good"
                go: 2.0 Feature loop
              - if: "tests fail due to code bugs"
                go: 2.2 Write minimal code (Green)
              - if: "tests themselves are wrong"
                go: 2.1 Write failing test (Red)
              - if: "design flaw discovered"
                go: 1.2 Design architecture

  # -- Integration --
  - 3.1 Integration testing

  - 3.2 Final review:
      next:
        - if: "all integration tests pass"
          go: Done
        - go: 2.0 Feature loop

  - Done:
      type: terminate
      reason: All features implemented and tests pass
